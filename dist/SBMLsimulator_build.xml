<!-- ANT build script for yfiles obfuscation           -->
<!-- The java based ANT tool is available from         -->
<!-- http://jakarta.apache.org/ant                     -->

<project name="SBMLsimulator" default="sign" basedir=".">

  <target name="help">
    <echo>
      This is an ANT build script to build a stand-alone JAR for
	    SBMLsimulator.
	    	
	    The resulting redistributable is the SIGNED jar file,
    	stored in $appJarSgn which is currently "SBMLsimulator.jar".
    </echo>
  </target>

  <!-- define some properties that are used throughout the tasks -->
  <target name="init">
  	<echo>
  	  PLESE MAKE SURE ALL PATHS ARE CORRECT AND DECIDE IF YOU WANT
  	  TO USE THE LIB-JARs OR REFERENFCED PROJETS.
  	</echo>
    <!-- the base directory of the SBMLsimulator repository -->
    <property name="base" location=".."/>
  	
    <!-- the path to the SBMLsimulator sources -->
  	<property name="src" location="${base}/src"/>
  	
    <!-- the path to the SBMLsimulator binaries -->
    <property name="classes" location="${base}/bin"/>
    
    <!-- the unsigned application jar file -->
    <property name="appJar" value="SBMLsimulator_unsigned.jar"/>

    <!-- the signed application jar file -->
    <property name="appJarSgn" value="SBMLsimulator.jar"/>
  	
  	
    <!-- =================================== -->
    <!-- PATHS TO REFERENCED PROJETS -->
    
    <!-- the path to SYSBIO -->
    <property name="SysBioPath" location="${base}/../SysBio" />
    <!-- the path to JSBML -->
    <property name="JSBMLPath" location="${base}/../jSBML" />
    <!-- the path to SBML2LaTeX -->
    <!--<property name="SBML2LaTeXPath" location="${base}/../SBML2LaTeX" />-->
    <!-- the path to SBMLsimulatorCore -->
    <property name="SBMLsimulatorCorePath" location="../lib/SimulationCoreLibrary_v1.1_slim.jar" />
    <!-- the path to SBMLsqueezer -->
    <!--<property name="SBMLsqueezerPath" location="${base}/../SBMLsqueezer" />-->
    <!-- =================================== -->
  	
  </target>

  <!-- puts the application specific classes into application.jar. -->
  <target name="jar" depends="init">
    <delete file="${appJar}"/>
    <jar jarfile="${appJar}">
      <manifest>
        <attribute name="Main-Class" value="org.sbml.simulator.SBMLsimulator"/>
        <attribute name="Built-By" value="Center for Bioinformatics Tuebingen (ZBIT)"/>
        <attribute name="SplashScreen-Image" value="org/sbml/simulator/gui/img/Splash.gif"/>
      </manifest>
    	
    	<!-- SBMLsimulator Classes -->
      <fileset dir="${classes}">
        <exclude name="**/package.html"/>
      </fileset>
    	
    	<!-- All libs without projects at the ZBIT -->
      <zipfileset excludes="META-INF/*.SF" src="${base}/lib/commons-math-2.2.jar"/>
      <zipfileset excludes="META-INF/*.SF" src="${base}/lib/jcommon-1.0.17.jar"/>
      <zipfileset excludes="META-INF/*.SF" src="${base}/lib/jfreechart-1.0.15_beta.jar"/>
      <!--<zipfileset excludes="META-INF/*.SF" src="${base}/lib/servlet.jar"/>-->
    	
      <!-- =================================== -->
      <!-- All libs WITH projects at the ZBIT -->
    	<!-- Every single one of them could be replaced by including the project itself, instead of the jar -->
    	
          <!--<zipfileset excludes="META-INF/*,de/zbit/resources/*,de/zbit/mapper/*,**/package.html,overview.html" src="${base}/lib/sysbio.jar"/> -->
          <fileset dir="${SysBioPath}/bin">
    	      <exclude name="de/zbit/resources/*"/>
    	      <exclude name="de/zbit/mapper/*"/>
    	      <exclude name="**/package.html"/>
    	      <exclude name="overview.html"/>
    	    </fileset>
          <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/commons-discovery.jar"/>
          <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/commons-logging.jar"/>
          <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/jaxrpc.jar"/>
          <!-- <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/keggapi.jar"/> -->
          <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/wsdl4j.jar"/>
          <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/axis.jar"/>
          <!-- <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/Java5/saaj.jar"/>-->
          <!-- <zipfileset excludes="META-INF/*.SF" src="${SysBioPath}/lib/WSDbfetch.jar"/>-->
          <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/commons-cli-1.1.jar"/>
          <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/quaqua.jar"/>
          <zipfileset excludes="META-INF/*" src="${SysBioPath}/lib/sysbio-osx-support.jar"/>
    	
          <!--<zipfileset excludes="META-INF/*.SF" src="${base}/lib/sbmlsqueezer.jar"/>-->
    	
          <zipfileset excludes="META-INF/*.SF" src="${base}/lib/SimulationCoreLibrary_v1.1_slim.jar"/>
          <!--<fileset dir="${SBMLsimulatorCorePath}/bin">
            <exclude name="**/package.html"/>
            <exclude name="overview.html"/>
          </fileset>-->
          	
          <!--<zipfileset excludes="META-INF/*.SF" src="${base}/lib/SBML2LaTeX-0.9.9_slim.jar"/>-->
    	
          <!--<zipfileset excludes="META-INF/*.SF" src="${base}/lib/jsbml-1.0-a1-with-dependencies.jar"/>-->
          <fileset dir="${JSBMLPath}/bin">
          	<exclude name="log4j.properties"/> <!-- log4j.properties is in SBML2Latex *and* jSBML -->
            <exclude name="**/package.html"/>
            <exclude name="overview.html"/>
          </fileset>
          <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/biojava-1.7-ontology.jar"/>
          <!-- <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/lib/junit-4.8.jar"/>-->
          <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/log4j-1.2.8.jar"/>
          <!-- <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/lib/stax-api-1.0.1.jar"/> -->
          <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/staxmate-2.0.0.jar"/>
          <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/xstream-1.3.1.jar"/>
          <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/jigsaw-dateParser.jar"/>
          <zipfileset excludes="META-INF/*.SF" src="${JSBMLPath}/core/lib/stax2-api-3.0.3.jar"/>
          <zipfileset excludes="META-INF/*.SF,META-INF/LICENSE*" src="${JSBMLPath}/core/lib/woodstox-core-lgpl-4.0.9.jar"/>
      
          <zipfileset excludes="META-INF/*.SF" src="${base}/lib/EvA2Base.jar"/>
      <!-- =================================== -->
      
    </jar>
  </target>

  <!-- signs the application -->
  <target name="sign" depends="jar">
  	<delete file="${appJarSgn}"/>
    <!-- Having an "keystore" file is required. Generate it with the "keytool" in the current directory. -->  	
	  <signjar alias="SBMLsimulator" jar="${appJar}" keypass="d=dpfSBMLsimulator!" keystore="keystore" signedjar="${appJarSgn}" storepass="d=dpfSBMLsimulator!"/>
  </target>

	
  <!-- executes the application -->
  <target name="run" depends="sign">
    <java classname="org.sbml.simulator.SBMLsimulator" fork="true">
      <classpath>
        <pathelement location="${appJarSgn}"/>
      </classpath>
    </java>
  </target>

  <!-- Removes all that has been built -->
  <target name="clean" depends="init">
  	<delete file="${appJar}"/>
    <delete file="${appJarSgn}"/>
    <delete includeemptydirs="true" dir="${classes}"/>
  </target>

</project>